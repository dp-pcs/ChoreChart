(()=>{var e={};e.id=882,e.ids=[882],e.modules={3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},30493:(e,t,s)=>{"use strict";let n,r,i,a;s.r(t),s.d(t,{patchFetch:()=>ng,routeModule:()=>nd,serverHooks:()=>nm,workAsyncStorage:()=>nf,workUnitAsyncStorage:()=>np});var o,l,c,h,u,d,f,p,m,g,y,w,_,b,v,x,S,A,$,k,I,O,R,E,T,P,C,N,M,j,L,W,D,B,U,q,F,X,H,J,K,V,z,Y,G,Q,Z,ee,et,es,en,er,ei,ea,eo,el,ec,eh,eu,ed,ef,ep,em,eg,ey,ew,e_,eb,ev,ex,eS,eA,e$,ek,eI,eO={};s.r(eO),s.d(eO,{GET:()=>nu,POST:()=>nh});var eR=s(96559),eE=s(48088),eT=s(37719),eP=s(32190);function eC(e,t,s,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s}function eN(e,t,s,n){if("a"===s&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}let eM=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return eM=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^s()&15>>e/4).toString(16))};function ej(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eL=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class eW extends Error{}class eD extends eW{constructor(e,t,s,n){super(`${eD.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new eU({message:s,cause:eL(t)});let r=t?.error;return 400===e?new eF(e,r,s,n):401===e?new eX(e,r,s,n):403===e?new eH(e,r,s,n):404===e?new eJ(e,r,s,n):409===e?new eK(e,r,s,n):422===e?new eV(e,r,s,n):429===e?new ez(e,r,s,n):e>=500?new eY(e,r,s,n):new eD(e,r,s,n)}}class eB extends eD{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class eU extends eD{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class eq extends eU{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eF extends eD{}class eX extends eD{}class eH extends eD{}class eJ extends eD{}class eK extends eD{}class eV extends eD{}class ez extends eD{}class eY extends eD{}class eG extends eW{constructor(){super("Could not parse response content as the length limit was reached")}}class eQ extends eW{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class eZ extends Error{constructor(e){super(e)}}let e0=/^[a-z][a-z0-9+.-]*:/i,e1=e=>e0.test(e),e2=e=>(e2=Array.isArray)(e),e3=e2;function e4(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let e5=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eW(`${e} must be an integer`);if(t<0)throw new eW(`${e} must be a positive integer`);return t},e8=e=>{try{return JSON.parse(e)}catch(e){return}},e6=e=>new Promise(t=>setTimeout(t,e)),e9="5.8.2",e7=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator,te=()=>{let e="undefined"!=typeof Deno&&null!=Deno.build?"deno":"undefined"!=typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e9,"X-Stainless-OS":ts(Deno.build.os),"X-Stainless-Arch":tt(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e9,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e9,"X-Stainless-OS":ts(globalThis.process.platform??"unknown"),"X-Stainless-Arch":tt(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,n=s[2]||0,r=s[3]||0;return{browser:e,version:`${t}.${n}.${r}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e9,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e9,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}},tt=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",ts=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",tn=()=>n??(n=te());function tr(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function ti(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return tr({start(){},async pull(e){let{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){await t.return?.()}})}function ta(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function to(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let tl=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),tc="RFC3986",th=e=>String(e),tu={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:th},td=(e,t)=>(td=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),tf=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function tp(e,t){if(e2(e)){let s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}let tm={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},tg=function(e,t){Array.prototype.push.apply(e,e2(t)?t:[t])},ty={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===s)return escape(i).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let a="";for(let e=0;e<i.length;e+=1024){let t=i.length>=1024?i.slice(e,e+1024):i,s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)){s[s.length]=t.charAt(e);continue}if(n<128){s[s.length]=tf[n];continue}if(n<2048){s[s.length]=tf[192|n>>6]+tf[128|63&n];continue}if(n<55296||n>=57344){s[s.length]=tf[224|n>>12]+tf[128|n>>6&63]+tf[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),s[s.length]=tf[240|n>>18]+tf[128|n>>12&63]+tf[128|n>>6&63]+tf[128|63&n]}a+=s.join("")}return a},encodeValuesOnly:!1,format:tc,formatter:th,indices:!1,serializeDate:e=>(r??(r=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},tw={};function t_(e){let t;return(i??(i=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function tb(e){let t;return(a??(a=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class tv{constructor(){o.set(this,void 0),l.set(this,void 0),eC(this,o,new Uint8Array,"f"),eC(this,l,null,"f")}decode(e){let t;if(null==e)return[];let s=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?t_(e):e;eC(this,o,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),n=0;for(let t of e)s.set(t,n),n+=t.length;return s}([eN(this,o,"f"),s]),"f");let n=[];for(;null!=(t=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(eN(this,o,"f"),eN(this,l,"f")));){if(t.carriage&&null==eN(this,l,"f")){eC(this,l,t.index,"f");continue}if(null!=eN(this,l,"f")&&(t.index!==eN(this,l,"f")+1||t.carriage)){n.push(tb(eN(this,o,"f").subarray(0,eN(this,l,"f")-1))),eC(this,o,eN(this,o,"f").subarray(eN(this,l,"f")),"f"),eC(this,l,null,"f");continue}let e=null!==eN(this,l,"f")?t.preceding-1:t.preceding,s=tb(eN(this,o,"f").subarray(0,e));n.push(s),eC(this,o,eN(this,o,"f").subarray(t.index),"f"),eC(this,l,null,"f")}return n}flush(){return eN(this,o,"f").length?this.decode("\n"):[]}}o=new WeakMap,l=new WeakMap,tv.NEWLINE_CHARS=new Set(["\n","\r"]),tv.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class tx{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;async function*n(){if(s)throw new eW("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(let s of tS(e,t))if(!n){if(s.data.startsWith("[DONE]")){n=!0;continue}if(null===s.event||s.event.startsWith("response.")||s.event.startsWith("transcript.")){let t;try{t=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if(t&&t.error)throw new eD(void 0,t.error,void 0,e.headers);yield t}else{let e;try{e=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("error"==s.event)throw new eD(void 0,e.error,e.message,void 0);yield{event:s.event,data:e}}}n=!0}catch(e){if(ej(e))return;throw e}finally{n||t.abort()}}return new tx(n,t)}static fromReadableStream(e,t){let s=!1;async function*n(){let t=new tv;for await(let s of ta(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new tx(async function*(){if(s)throw new eW("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(ej(e))return;throw e}finally{e||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new tx(()=>n(e),this.controller),new tx(()=>n(t),this.controller)]}toReadableStream(){let e,t=this;return tr({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:n}=await e.next();if(n)return t.close();let r=t_(JSON.stringify(s)+"\n");t.enqueue(r)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*tS(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eW("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eW("Attempted to iterate over a response with no body")}let s=new t$,n=new tv;for await(let t of tA(ta(e.body)))for(let e of n.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of n.flush()){let t=s.decode(e);t&&(yield t)}}async function*tA(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let n=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?t_(s):s,r=new Uint8Array(t.length+n.length);for(r.set(t),r.set(n,t.length),t=r;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class t${constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e,t){let s=e.indexOf(":");return -1!==s?[e.substring(0,s),t,e.substring(s+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}let tk={off:0,error:200,warn:300,info:400,debug:500},tI=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(tk,e))return e;tP(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(tk))}`)}};function tO(){}function tR(e,t,s){return!t||tk[e]>tk[s]?tO:t[e].bind(t)}let tE={error:tO,warn:tO,info:tO,debug:tO},tT=new WeakMap;function tP(e){let t=e.logger,s=e.logLevel??"off";if(!t)return tE;let n=tT.get(t);if(n&&n[0]===s)return n[1];let r={error:tR("error",t,s),warn:tR("warn",t,s),info:tR("info",t,s),debug:tR("debug",t,s)};return tT.set(t,[s,r]),r}let tC=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);async function tN(e,t){let{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:i}=t,a=await (async()=>{if(t.options.stream)return(tP(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller):tx.fromSSEResponse(s,t.controller);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let n=s.headers.get("content-type"),r=n?.split(";")[0]?.trim();return r?.includes("application/json")||r?.endsWith("+json")?tM(await s.json(),s):await s.text()})();return tP(e).debug(`[${n}] response parsed`,tC({retryOfRequestLogID:r,url:s.url,status:s.status,body:a,durationMs:Date.now()-i})),a}function tM(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class tj extends Promise{constructor(e,t,s=tN){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,c.set(this,void 0),eC(this,c,e,"f")}_thenUnwrap(e){return new tj(eN(this,c,"f"),this.responsePromise,async(t,s)=>tM(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(eN(this,c,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}c=new WeakMap;class tL{constructor(e,t,s,n){h.set(this,void 0),eC(this,h,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new eW("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await eN(this,h,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(h=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tW extends tj{constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await tN(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tD extends tL{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class tB extends tL{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){var e;let t=this.getPaginatedItems(),s=t[t.length-1]?.id;return s?{...this.options,query:{..."object"!=typeof(e=this.options.query)?{}:e??{},after:s}}:null}}let tU=()=>{if("undefined"==typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tq(e,t,s){return tU(),new File(e,t??"unknown_file",s)}function tF(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let tX=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tH=async(e,t)=>({...e,body:await tK(e.body,t)}),tJ=new WeakMap,tK=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=tJ.get(t);if(s)return s;let n=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return tJ.set(t,n),n}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>tG(s,e,t))),s},tV=e=>e instanceof Blob&&"name"in e,tz=e=>"object"==typeof e&&null!==e&&(e instanceof Response||tX(e)||tV(e)),tY=e=>{if(tz(e))return!0;if(Array.isArray(e))return e.some(tY);if(e&&"object"==typeof e){for(let t in e)if(tY(e[t]))return!0}return!1},tG=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,tq([await s.blob()],tF(s)));else if(tX(s))e.append(t,tq([await new Response(ti(s)).blob()],tF(s)));else if(tV(s))e.append(t,s,tF(s));else if(Array.isArray(s))await Promise.all(s.map(s=>tG(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,n])=>tG(e,`${t}[${s}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},tQ=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,tZ=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&tQ(e),t0=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob;async function t1(e,t,s){if(tU(),tZ(e=await e))return e instanceof File?e:tq([await e.arrayBuffer()],e.name);if(t0(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tq(await t2(n),t,s)}let n=await t2(e);if(t||(t=tF(e)),!s?.type){let e=n.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tq(n,t,s)}async function t2(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(tQ(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tX(e))for await(let s of e)t.push(...await t2(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class t3{constructor(e){this._client=e}}function t4(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let t5=((e=t4)=>function(t,...s){let n;if(1===t.length)return t[0];let r=!1,i=t.reduce((t,n,i)=>(/[?#]/.test(n)&&(r=!0),t+n+(i===s.length?"":(r?encodeURIComponent:e)(String(s[i])))),""),a=i.split(/[?#]/,1)[0],o=[],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(a));)o.push({start:n.index,length:n[0].length});if(o.length>0){let e=0,t=o.reduce((t,s)=>{let n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r},"");throw new eW(`Path parameters result in path with invalid segments:
${i}
${t}`)}return i})(t4);class t8 extends t3{list(e,t={},s){return this._client.getAPIList(t5`/chat/completions/${e}/messages`,tB,{query:t,...s})}}let t6=e=>e?.role==="assistant",t9=e=>e?.role==="tool";class t7{constructor(){u.add(this),this.controller=new AbortController,d.set(this,void 0),f.set(this,()=>{}),p.set(this,()=>{}),m.set(this,void 0),g.set(this,()=>{}),y.set(this,()=>{}),w.set(this,{}),_.set(this,!1),b.set(this,!1),v.set(this,!1),x.set(this,!1),eC(this,d,new Promise((e,t)=>{eC(this,f,e,"f"),eC(this,p,t,"f")}),"f"),eC(this,m,new Promise((e,t)=>{eC(this,g,e,"f"),eC(this,y,t,"f")}),"f"),eN(this,d,"f").catch(()=>{}),eN(this,m,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},eN(this,u,"m",S).bind(this))},0)}_connected(){this.ended||(eN(this,f,"f").call(this),this._emit("connect"))}get ended(){return eN(this,_,"f")}get errored(){return eN(this,b,"f")}get aborted(){return eN(this,v,"f")}abort(){this.controller.abort()}on(e,t){return(eN(this,w,"f")[e]||(eN(this,w,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eN(this,w,"f")[e];if(!s)return this;let n=s.findIndex(e=>e.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(eN(this,w,"f")[e]||(eN(this,w,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{eC(this,x,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){eC(this,x,!0,"f"),await eN(this,m,"f")}_emit(e,...t){if(eN(this,_,"f"))return;"end"===e&&(eC(this,_,!0,"f"),eN(this,g,"f").call(this));let s=eN(this,w,"f")[e];if(s&&(eN(this,w,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eN(this,x,"f")||s?.length||Promise.reject(e),eN(this,p,"f").call(this,e),eN(this,y,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eN(this,x,"f")||s?.length||Promise.reject(e),eN(this,p,"f").call(this,e),eN(this,y,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function se(e){return e?.$brand==="auto-parseable-response-format"}function st(e){return e?.$brand==="auto-parseable-tool"}function ss(e,t){let s=e.choices.map(e=>{var s,n;if("length"===e.finish_reason)throw new eG;if("content_filter"===e.finish_reason)throw new eQ;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let s=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:st(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=t,n=e.message.content,s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(n):JSON.parse(n):null):null}}});return{...e,choices:s}}function sn(e){return!!se(e.response_format)||(e.tools?.some(e=>st(e)||"function"===e.type&&!0===e.function.strict)??!1)}d=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,_=new WeakMap,b=new WeakMap,v=new WeakMap,x=new WeakMap,u=new WeakSet,S=function(e){if(eC(this,b,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new eB),e instanceof eB)return eC(this,v,!0,"f"),this._emit("abort",e);if(e instanceof eW)return this._emit("error",e);if(e instanceof Error){let t=new eW(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eW(String(e)))};class sr extends t7{constructor(){super(...arguments),A.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),t9(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(t6(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new eW("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),eN(this,A,"m",$).call(this)}async finalMessage(){return await this.done(),eN(this,A,"m",k).call(this)}async finalFunctionToolCall(){return await this.done(),eN(this,A,"m",I).call(this)}async finalFunctionToolCallResult(){return await this.done(),eN(this,A,"m",O).call(this)}async totalUsage(){return await this.done(),eN(this,A,"m",R).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=eN(this,A,"m",k).call(this);t&&this._emit("finalMessage",t);let s=eN(this,A,"m",$).call(this);s&&this._emit("finalContent",s);let n=eN(this,A,"m",I).call(this);n&&this._emit("finalFunctionToolCall",n);let r=eN(this,A,"m",O).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",eN(this,A,"m",R).call(this))}async _createChatCompletion(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eN(this,A,"m",E).call(this,t);let r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(ss(r,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let n="tool",{tool_choice:r="auto",stream:i,...a}=t,o="string"!=typeof r&&r?.function?.name,{maxChatCompletions:l=10}=s||{},c=t.tools.map(e=>{if(st(e)){if(!e.$callback)throw new eW("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),h={};for(let e of c)"function"===e.type&&(h[e.function.name||e.function.function.name]=e.function);let u="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...a,tool_choice:r,tools:u,messages:[...this.messages]},s),i=t.choices[0]?.message;if(!i)throw new eW("missing message in ChatCompletion response");if(!i.tool_calls?.length)break;for(let e of i.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:r,arguments:i}=e.function,a=h[r];if(a){if(o&&o!==r){let e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${Object.keys(h).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}try{t="function"==typeof a.parse?await a.parse(i):i}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:s,content:e});continue}let l=await a.function(t,this),c=eN(this,A,"m",T).call(this,l);if(this._addMessage({role:n,tool_call_id:s,content:c}),o)return}}}}A=new WeakSet,$=function(){return eN(this,A,"m",k).call(this).content??null},k=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(t6(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new eW("stream ended without producing a ChatCompletionMessage with role=assistant")},I=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(t6(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},O=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(t9(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},R=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},E=function(e){if(null!=e.n&&e.n>1)throw new eW("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},T=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class si extends sr{static runTools(e,t,s){let n=new si,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}_addMessage(e,t=!0){super._addMessage(e,t),t6(e)&&e.content&&this._emit("content",e.content)}}let sa={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class so extends Error{}class sl extends Error{}let sc=(e,t)=>{let s=e.length,n=0,r=e=>{throw new so(`${e} at position ${n}`)},i=e=>{throw new sl(`${e} at position ${n}`)},a=()=>(u(),n>=s&&r("Unexpected end of input"),'"'===e[n])?o():"{"===e[n]?l():"["===e[n]?c():"null"===e.substring(n,n+4)||sa.NULL&t&&s-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||sa.BOOL&t&&s-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||sa.BOOL&t&&s-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||sa.INFINITY&t&&s-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||sa.MINUS_INFINITY&t&&1<s-n&&s-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||sa.NAN&t&&s-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):h(),o=()=>{let a=n,o=!1;for(n++;n<s&&('"'!==e[n]||o&&"\\"===e[n-1]);)o="\\"===e[n]&&!o,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(a,++n-Number(o)))}catch(e){i(String(e))}else if(sa.STR&t)try{return JSON.parse(e.substring(a,n-Number(o))+'"')}catch(t){return JSON.parse(e.substring(a,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},l=()=>{n++,u();let i={};try{for(;"}"!==e[n];){if(u(),n>=s&&sa.OBJ&t)return i;let r=o();u(),n++;try{let e=a();Object.defineProperty(i,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(sa.OBJ&t)return i;throw e}u(),","===e[n]&&n++}}catch(e){if(sa.OBJ&t)return i;r("Expected '}' at end of object")}return n++,i},c=()=>{n++;let s=[];try{for(;"]"!==e[n];)s.push(a()),u(),","===e[n]&&n++}catch(e){if(sa.ARR&t)return s;r("Expected ']' at end of array")}return n++,s},h=()=>{if(0===n){"-"===e&&sa.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(s){if(sa.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}i(String(s))}}let a=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=s||sa.NUM&t||r("Unterminated number literal");try{return JSON.parse(e.substring(a,n))}catch(s){"-"===e.substring(a,n)&&sa.NUM&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(a,e.lastIndexOf("e")))}catch(e){i(String(e))}}},u=()=>{for(;n<s&&" \n\r	".includes(e[n]);)n++};return a()},sh=e=>(function(e,t=sa.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return sc(e.trim(),t)})(e,sa.ALL^sa.NUM);class su extends sr{constructor(e){super(),P.add(this),C.set(this,void 0),N.set(this,void 0),M.set(this,void 0),eC(this,C,e,"f"),eC(this,N,[],"f")}get currentChatCompletionSnapshot(){return eN(this,M,"f")}static fromReadableStream(e){let t=new su(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let n=new su(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,s){super._createChatCompletion;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eN(this,P,"m",j).call(this);let r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),r))eN(this,P,"m",W).call(this,e);if(r.controller.signal?.aborted)throw new eB;return this._addChatCompletion(eN(this,P,"m",U).call(this))}async _fromReadableStream(e,t){let s,n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eN(this,P,"m",j).call(this),this._connected();let r=tx.fromReadableStream(e,this.controller);for await(let e of r)s&&s!==e.id&&this._addChatCompletion(eN(this,P,"m",U).call(this)),eN(this,P,"m",W).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new eB;return this._addChatCompletion(eN(this,P,"m",U).call(this))}[(C=new WeakMap,N=new WeakMap,M=new WeakMap,P=new WeakSet,j=function(){this.ended||eC(this,M,void 0,"f")},L=function(e){let t=eN(this,N,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},eN(this,N,"f")[e.index]=t),t},W=function(e){if(this.ended)return;let t=eN(this,P,"m",F).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=eN(this,P,"m",L).call(this,e);for(let t of(e.finish_reason&&(eN(this,P,"m",B).call(this,e),null!=n.current_tool_call_index&&eN(this,P,"m",D).call(this,e,n.current_tool_call_index)),s.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(eN(this,P,"m",B).call(this,e),null!=n.current_tool_call_index&&eN(this,P,"m",D).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):s?.type)}}},D=function(e,t){if(eN(this,P,"m",L).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=eN(this,C,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:st(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},B=function(e){let t=eN(this,P,"m",L).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=eN(this,P,"m",q).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},U=function(){if(this.ended)throw new eW("stream has ended, this shouldn't happen");let e=eN(this,M,"f");if(!e)throw new eW("request ended without sending any chunks");return eC(this,M,void 0,"f"),eC(this,N,[],"f"),function(e,t){var s;let{id:n,choices:r,created:i,model:a,system_fingerprint:o,...l}=e;return s={...l,id:n,choices:r.map(({message:t,finish_reason:s,index:n,logprobs:r,...i})=>{if(!s)throw new eW(`missing finish_reason for choice ${n}`);let{content:a=null,function_call:o,tool_calls:l,...c}=t,h=t.role;if(!h)throw new eW(`missing role for choice ${n}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new eW(`missing function_call.arguments for choice ${n}`);if(!l)throw new eW(`missing function_call.name for choice ${n}`);return{...i,message:{content:a,function_call:{arguments:e,name:l},role:h,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}return l?{...i,index:n,finish_reason:s,logprobs:r,message:{...c,role:h,content:a,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:r,type:i,id:a,...o}=t,{arguments:l,name:c,...h}=r||{};if(null==a)throw new eW(`missing choices[${n}].tool_calls[${s}].id
${sd(e)}`);if(null==i)throw new eW(`missing choices[${n}].tool_calls[${s}].type
${sd(e)}`);if(null==c)throw new eW(`missing choices[${n}].tool_calls[${s}].function.name
${sd(e)}`);if(null==l)throw new eW(`missing choices[${n}].tool_calls[${s}].function.arguments
${sd(e)}`);return{...o,id:a,type:i,function:{...h,name:c,arguments:l}}})}}:{...i,message:{...c,content:a,role:h,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}),created:i,model:a,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&sn(t)?ss(s,t):{...s,choices:s.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,eN(this,C,"f"))},q=function(){let e=eN(this,C,"f")?.response_format;return se(e)?e:null},F=function(e){var t,s,n,r;let i=eN(this,M,"f"),{choices:a,...o}=e;for(let{delta:a,finish_reason:l,index:c,logprobs:h=null,...u}of(i?Object.assign(i,o):i=eC(this,M,{...o,choices:[]},"f"),e.choices)){let e=i.choices[c];if(e||(e=i.choices[c]={finish_reason:l,index:c,message:{},logprobs:h,...u}),h)if(e.logprobs){let{content:n,refusal:r,...i}=h;Object.assign(e.logprobs,i),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},h);if(l&&(e.finish_reason=l,eN(this,C,"f")&&sn(eN(this,C,"f")))){if("length"===l)throw new eG;if("content_filter"===l)throw new eQ}if(Object.assign(e,u),!a)continue;let{content:o,refusal:d,function_call:f,role:p,tool_calls:m,...g}=a;if(Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),p&&(e.message.role=p),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&eN(this,P,"m",q).call(this)&&(e.message.parsed=sh(e.message.content))),m)for(let{index:t,id:s,type:n,function:i,...a}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,a),s&&(o.id=s),n&&(o.type=n),i&&(o.function??(o.function={name:i.name??"",arguments:""})),i?.name&&(o.function.name=i.name),i?.arguments&&(o.function.arguments+=i.arguments,function(e,t){if(!e)return!1;let s=e.tools?.find(e=>e.function?.name===t.function.name);return st(s)||s?.function.strict||!1}(eN(this,C,"f"),o)&&(o.function.parsed_arguments=sh(o.function.arguments)))}}return i},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tx(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function sd(e){return JSON.stringify(e)}class sf extends su{static fromReadableStream(e){let t=new sf(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let n=new sf(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}}class sp extends t3{constructor(){super(...arguments),this.messages=new t8(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(t5`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(t5`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",tB,{query:e,...t})}delete(e,t){return this._client.delete(t5`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new eW(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new eW(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>ss(t,e))}runTools(e,t){return e.stream?sf.runTools(this._client,e,t):si.runTools(this._client,e,t)}stream(e,t){return su.createChatCompletion(this._client,e,t)}}sp.Messages=t8;class sm extends t3{constructor(){super(...arguments),this.completions=new sp(this._client)}}sm.Completions=sp;let sg=Symbol("brand.privateNullableHeaders"),sy=e=>{let t=new Headers,s=new Set;for(let n of e){let e=new Set;for(let[r,i]of function*(e){let t;if(!e)return;if(sg in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let n of(e instanceof Headers?t=e.entries():e3(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=e3(n[1])?n[1]:[n[1]],r=!1;for(let n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}(n)){let n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===i?(t.delete(r),s.add(n)):(t.append(r,i),s.delete(n))}}return{[sg]:!0,values:t,nulls:s}};class sw extends t3{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:sy([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class s_ extends t3{create(e,t){return this._client.post("/audio/transcriptions",tH({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class sb extends t3{create(e,t){return this._client.post("/audio/translations",tH({body:e,...t,__metadata:{model:e.model}},this._client))}}class sv extends t3{constructor(){super(...arguments),this.transcriptions=new s_(this._client),this.translations=new sb(this._client),this.speech=new sw(this._client)}}sv.Transcriptions=s_,sv.Translations=sb,sv.Speech=sw;class sx extends t3{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(t5`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",tB,{query:e,...t})}cancel(e,t){return this._client.post(t5`/batches/${e}/cancel`,t)}}class sS extends t3{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t5`/assistants/${e}`,{...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t5`/assistants/${e}`,{body:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",tB,{query:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(t5`/assistants/${e}`,{...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sA extends t3{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class s$ extends t3{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sk extends t3{constructor(){super(...arguments),this.sessions=new sA(this._client),this.transcriptionSessions=new s$(this._client)}}sk.Sessions=sA,sk.TranscriptionSessions=s$;class sI extends t3{create(e,t,s){return this._client.post(t5`/threads/${e}/messages`,{body:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(t5`/threads/${n}/messages/${e}`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(t5`/threads/${n}/messages/${e}`,{body:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t5`/threads/${e}/messages`,tB,{query:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:n}=t;return this._client.delete(t5`/threads/${n}/messages/${e}`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class sO extends t3{retrieve(e,t,s){let{thread_id:n,run_id:r,...i}=t;return this._client.get(t5`/threads/${n}/runs/${r}/steps/${e}`,{query:i,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:n,...r}=t;return this._client.getAPIList(t5`/threads/${n}/runs/${e}/steps`,tB,{query:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let sR=e=>{if("undefined"!=typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}},sE=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class sT extends t7{constructor(){super(...arguments),X.add(this),J.set(this,[]),K.set(this,{}),V.set(this,{}),z.set(this,void 0),Y.set(this,void 0),G.set(this,void 0),Q.set(this,void 0),Z.set(this,void 0),ee.set(this,void 0),et.set(this,void 0),es.set(this,void 0),en.set(this,void 0)}[(J=new WeakMap,K=new WeakMap,V=new WeakMap,z=new WeakMap,Y=new WeakMap,G=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,es=new WeakMap,en=new WeakMap,X=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new H;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=tx.fromReadableStream(e,this.controller);for await(let e of n)eN(this,X,"m",er).call(this,e);if(n.controller.signal?.aborted)throw new eB;return this._addRun(eN(this,X,"m",ei).call(this))}toReadableStream(){return new tx(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n){let r=new H;return r._run(()=>r._runToolAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.submitToolOutputs(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))eN(this,X,"m",er).call(this,e);if(a.controller.signal?.aborted)throw new eB;return this._addRun(eN(this,X,"m",ei).call(this))}static createThreadAssistantStream(e,t,s){let n=new H;return n._run(()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,s,n){let r=new H;return r._run(()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return eN(this,et,"f")}currentRun(){return eN(this,es,"f")}currentMessageSnapshot(){return eN(this,z,"f")}currentRunStepSnapshot(){return eN(this,en,"f")}async finalRunSteps(){return await this.done(),Object.values(eN(this,K,"f"))}async finalMessages(){return await this.done(),Object.values(eN(this,V,"f"))}async finalRun(){if(await this.done(),!eN(this,Y,"f"))throw Error("Final run was not received.");return eN(this,Y,"f")}async _createThreadAssistantStream(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let r={...t,stream:!0},i=await e.createAndRun(r,{...s,signal:this.controller.signal});for await(let e of(this._connected(),i))eN(this,X,"m",er).call(this,e);if(i.controller.signal?.aborted)throw new eB;return this._addRun(eN(this,X,"m",ei).call(this))}async _createAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let i={...s,stream:!0},a=await e.create(t,i,{...n,signal:this.controller.signal});for await(let e of(this._connected(),a))eN(this,X,"m",er).call(this,e);if(a.controller.signal?.aborted)throw new eB;return this._addRun(eN(this,X,"m",ei).call(this))}static accumulateDelta(e,t){for(let[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(e4(t)&&e4(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!e4(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n){return await this._createToolAssistantStream(t,e,s,n)}}H=sT,er=function(e){if(!this.ended)switch(eC(this,et,e,"f"),eN(this,X,"m",el).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":eN(this,X,"m",ed).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eN(this,X,"m",eo).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":eN(this,X,"m",ea).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},ei=function(){if(this.ended)throw new eW("stream has ended, this shouldn't happen");if(!eN(this,Y,"f"))throw Error("Final run has not been received");return eN(this,Y,"f")},ea=function(e){let[t,s]=eN(this,X,"m",eh).call(this,e,eN(this,z,"f"));for(let e of(eC(this,z,t,"f"),eN(this,V,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=eN(this,G,"f")){if(eN(this,Q,"f"))switch(eN(this,Q,"f").type){case"text":this._emit("textDone",eN(this,Q,"f").text,eN(this,z,"f"));break;case"image_file":this._emit("imageFileDone",eN(this,Q,"f").image_file,eN(this,z,"f"))}eC(this,G,s.index,"f")}eC(this,Q,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==eN(this,G,"f")){let t=e.data.content[eN(this,G,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,eN(this,z,"f"));break;case"text":this._emit("textDone",t.text,eN(this,z,"f"))}}eN(this,z,"f")&&this._emit("messageDone",e.data),eC(this,z,void 0,"f")}},eo=function(e){let t=eN(this,X,"m",ec).call(this,e);switch(eC(this,en,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==eN(this,Z,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(eN(this,ee,"f")&&this._emit("toolCallDone",eN(this,ee,"f")),eC(this,Z,e.index,"f"),eC(this,ee,t.step_details.tool_calls[e.index],"f"),eN(this,ee,"f")&&this._emit("toolCallCreated",eN(this,ee,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eC(this,en,void 0,"f"),"tool_calls"==e.data.step_details.type&&eN(this,ee,"f")&&(this._emit("toolCallDone",eN(this,ee,"f")),eC(this,ee,void 0,"f")),this._emit("runStepDone",e.data,t)}},el=function(e){eN(this,J,"f").push(e),this._emit("event",e)},ec=function(e){switch(e.event){case"thread.run.step.created":return eN(this,K,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=eN(this,K,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let n=H.accumulateDelta(t,s.delta);eN(this,K,"f")[e.data.id]=n}return eN(this,K,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":eN(this,K,"f")[e.data.id]=e.data}if(eN(this,K,"f")[e.data.id])return eN(this,K,"f")[e.data.id];throw Error("No snapshot available")},eh=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=eN(this,X,"m",eu).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},eu=function(e,t){return H.accumulateDelta(t,e)},ed=function(e){switch(eC(this,es,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":eC(this,Y,e.data,"f"),eN(this,ee,"f")&&(this._emit("toolCallDone",eN(this,ee,"f")),eC(this,ee,void 0,"f"))}};class sP extends t3{constructor(){super(...arguments),this.steps=new sO(this._client)}create(e,t,s){let{include:n,...r}=t;return this._client.post(t5`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(t5`/threads/${n}/runs/${e}`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(t5`/threads/${n}/runs/${e}`,{body:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t5`/threads/${e}/runs`,tB,{query:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:n}=t;return this._client.post(t5`/threads/${n}/runs/${e}/cancel`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(n.id,{thread_id:e},s)}createAndStream(e,t,s){return sT.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let n=sy([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e6(a);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return sT.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:n,...r}=t;return this._client.post(t5`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let n=await this.submitToolOutputs(e,t,s);return await this.poll(n.id,t,s)}submitToolOutputsStream(e,t,s){return sT.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}sP.Steps=sO;class sC extends t3{constructor(){super(...arguments),this.runs=new sP(this._client),this.messages=new sI(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t5`/threads/${e}`,{...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t5`/threads/${e}`,{body:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(t5`/threads/${e}`,{...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return sT.createThreadAssistantStream(e,this._client.beta.threads,t)}}sC.Runs=sP,sC.Messages=sI;class sN extends t3{constructor(){super(...arguments),this.realtime=new sk(this._client),this.assistants=new sS(this._client),this.threads=new sC(this._client)}}sN.Realtime=sk,sN.Assistants=sS,sN.Threads=sC;class sM extends t3{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class sj extends t3{retrieve(e,t,s){let{container_id:n}=t;return this._client.get(t5`/containers/${n}/files/${e}/content`,{...s,headers:sy([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class sL extends t3{constructor(){super(...arguments),this.content=new sj(this._client)}create(e,t,s){return this._client.post(t5`/containers/${e}/files`,tH({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:n}=t;return this._client.get(t5`/containers/${n}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(t5`/containers/${e}/files`,tB,{query:t,...s})}delete(e,t,s){let{container_id:n}=t;return this._client.delete(t5`/containers/${n}/files/${e}`,{...s,headers:sy([{Accept:"*/*"},s?.headers])})}}sL.Content=sj;class sW extends t3{constructor(){super(...arguments),this.files=new sL(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(t5`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",tB,{query:e,...t})}delete(e,t){return this._client.delete(t5`/containers/${e}`,{...t,headers:sy([{Accept:"*/*"},t?.headers])})}}sW.Files=sL;class sD extends t3{create(e,t){let s=!!e.encoding_format,n=s?e.encoding_format:"base64";s&&tP(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let r=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return s?r:(tP(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=sR(t)}),e)))}}class sB extends t3{retrieve(e,t,s){let{eval_id:n,run_id:r}=t;return this._client.get(t5`/evals/${n}/runs/${r}/output_items/${e}`,s)}list(e,t,s){let{eval_id:n,...r}=t;return this._client.getAPIList(t5`/evals/${n}/runs/${e}/output_items`,tB,{query:r,...s})}}class sU extends t3{constructor(){super(...arguments),this.outputItems=new sB(this._client)}create(e,t,s){return this._client.post(t5`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:n}=t;return this._client.get(t5`/evals/${n}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(t5`/evals/${e}/runs`,tB,{query:t,...s})}delete(e,t,s){let{eval_id:n}=t;return this._client.delete(t5`/evals/${n}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:n}=t;return this._client.post(t5`/evals/${n}/runs/${e}`,s)}}sU.OutputItems=sB;class sq extends t3{constructor(){super(...arguments),this.runs=new sU(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(t5`/evals/${e}`,t)}update(e,t,s){return this._client.post(t5`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",tB,{query:e,...t})}delete(e,t){return this._client.delete(t5`/evals/${e}`,t)}}sq.Runs=sU;class sF extends t3{create(e,t){return this._client.post("/files",tH({body:e,...t},this._client))}retrieve(e,t){return this._client.get(t5`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",tB,{query:e,...t})}delete(e,t){return this._client.delete(t5`/files/${e}`,t)}content(e,t){return this._client.get(t5`/files/${e}/content`,{...t,headers:sy([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let n=new Set(["processed","error","deleted"]),r=Date.now(),i=await this.retrieve(e);for(;!i.status||!n.has(i.status);)if(await e6(t),i=await this.retrieve(e),Date.now()-r>s)throw new eq({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return i}}class sX extends t3{}class sH extends t3{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class sJ extends t3{constructor(){super(...arguments),this.graders=new sH(this._client)}}sJ.Graders=sH;class sK extends t3{create(e,t,s){return this._client.getAPIList(t5`/fine_tuning/checkpoints/${e}/permissions`,tD,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(t5`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(t5`/fine_tuning/checkpoints/${n}/permissions/${e}`,s)}}class sV extends t3{constructor(){super(...arguments),this.permissions=new sK(this._client)}}sV.Permissions=sK;class sz extends t3{list(e,t={},s){return this._client.getAPIList(t5`/fine_tuning/jobs/${e}/checkpoints`,tB,{query:t,...s})}}class sY extends t3{constructor(){super(...arguments),this.checkpoints=new sz(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(t5`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",tB,{query:e,...t})}cancel(e,t){return this._client.post(t5`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(t5`/fine_tuning/jobs/${e}/events`,tB,{query:t,...s})}pause(e,t){return this._client.post(t5`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(t5`/fine_tuning/jobs/${e}/resume`,t)}}sY.Checkpoints=sz;class sG extends t3{constructor(){super(...arguments),this.methods=new sX(this._client),this.jobs=new sY(this._client),this.checkpoints=new sV(this._client),this.alpha=new sJ(this._client)}}sG.Methods=sX,sG.Jobs=sY,sG.Checkpoints=sV,sG.Alpha=sJ;class sQ extends t3{}class sZ extends t3{constructor(){super(...arguments),this.graderModels=new sQ(this._client)}}sZ.GraderModels=sQ;class s0 extends t3{createVariation(e,t){return this._client.post("/images/variations",tH({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",tH({body:e,...t},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class s1 extends t3{retrieve(e,t){return this._client.get(t5`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",tD,e)}delete(e,t){return this._client.delete(t5`/models/${e}`,t)}}class s2 extends t3{create(e,t){return this._client.post("/moderations",{body:e,...t})}}function s3(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){let s=function(e,t){return e.find(e=>"function"===e.type&&e.name===t)}(e.tools??[],t.name);return{...t,...t,parsed_arguments:function(e){return e?.$brand==="auto-parseable-tool"}(s)?s.$parseRaw(t.arguments):s?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s,n;return"output_text"===e.type?{...e,parsed:(s=t,n=e.text,s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(n):JSON.parse(n))}:e});return{...e,content:s}}return e}),n=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||s4(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function s4(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}class s5 extends t7{constructor(e){super(),ef.add(this),ep.set(this,void 0),em.set(this,void 0),eg.set(this,void 0),eC(this,ep,e,"f")}static createResponse(e,t,s){let n=new s5(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,s){let n,r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eN(this,ef,"m",ey).call(this);let i=null;for await(let r of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),i=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),n))eN(this,ef,"m",ew).call(this,r,i);if(n.controller.signal?.aborted)throw new eB;return eN(this,ef,"m",e_).call(this)}[(ep=new WeakMap,em=new WeakMap,eg=new WeakMap,ef=new WeakSet,ey=function(){this.ended||eC(this,em,void 0,"f")},ew=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},n=eN(this,ef,"m",eb).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new eW(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new eW(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new eW(`expected content to be 'output_text', got ${n.type}`);s("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new eW(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},e_=function(){if(this.ended)throw new eW("stream has ended, this shouldn't happen");let e=eN(this,em,"f");if(!e)throw new eW("request ended without sending any events");eC(this,em,void 0,"f");let t=function(e,t){var s;return t&&(s=t,se(s.text?.format))?s3(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,eN(this,ep,"f"));return eC(this,eg,t,"f"),t},eb=function(e){let t=eN(this,em,"f");if(!t){if("response.created"!==e.type)throw new eW(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return eC(this,em,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new eW(`missing output at index ${e.output_index}`);"message"===s.type&&s.content.push(e.part);break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new eW(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new eW(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new eW(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new eW(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.completed":eC(this,em,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=eN(this,eg,"f");if(!e)throw new eW("stream ended without producing a ChatCompletion");return e}}class s8 extends t3{list(e,t={},s){return this._client.getAPIList(t5`/responses/${e}/input_items`,tB,{query:t,...s})}}class s6 extends t3{constructor(){super(...arguments),this.inputItems=new s8(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&s4(e),e))}retrieve(e,t={},s){return this._client.get(t5`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&s4(e),e))}delete(e,t){return this._client.delete(t5`/responses/${e}`,{...t,headers:sy([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>s3(t,e))}stream(e,t){return s5.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(t5`/responses/${e}/cancel`,t)}}s6.InputItems=s8;class s9 extends t3{create(e,t,s){return this._client.post(t5`/uploads/${e}/parts`,tH({body:t,...s},this._client))}}class s7 extends t3{constructor(){super(...arguments),this.parts=new s9(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(t5`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(t5`/uploads/${e}/complete`,{body:t,...s})}}s7.Parts=s9;let ne=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class nt extends t3{create(e,t,s){return this._client.post(t5`/vector_stores/${e}/file_batches`,{body:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(t5`/vector_stores/${n}/file_batches/${e}`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:n}=t;return this._client.post(t5`/vector_stores/${n}/file_batches/${e}/cancel`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s){let{vector_store_id:n,...r}=t;return this._client.getAPIList(t5`/vector_stores/${n}/file_batches/${e}/files`,tB,{query:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let n=sy([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:i}=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=i.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e6(a);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let r=Math.min(n?.maxConcurrency??5,t.length),i=this._client,a=t.values(),o=[...s];async function l(e){for(let t of e){let e=await i.files.create({file:t,purpose:"assistants"},n);o.push(e.id)}}let c=Array(r).fill(a).map(l);return await ne(c),await this.createAndPoll(e,{file_ids:o})}}class ns extends t3{create(e,t,s){return this._client.post(t5`/vector_stores/${e}/files`,{body:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(t5`/vector_stores/${n}/files/${e}`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:n,...r}=t;return this._client.post(t5`/vector_stores/${n}/files/${e}`,{body:r,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(t5`/vector_stores/${e}/files`,tB,{query:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:n}=t;return this._client.delete(t5`/vector_stores/${n}/files/${e}`,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){let n=sy([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let r=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse(),i=r.data;switch(i.status){case"in_progress":let a=5e3;if(s?.pollIntervalMs)a=s.pollIntervalMs;else{let e=r.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(a=t)}}await e6(a);break;case"failed":case"completed":return i}}}async upload(e,t,s){let n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){let n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}content(e,t,s){let{vector_store_id:n}=t;return this._client.getAPIList(t5`/vector_stores/${n}/files/${e}/content`,tD,{...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class nn extends t3{constructor(){super(...arguments),this.files=new ns(this._client),this.fileBatches=new nt(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(t5`/vector_stores/${e}`,{...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(t5`/vector_stores/${e}`,{body:t,...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",tB,{query:e,...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(t5`/vector_stores/${e}`,{...t,headers:sy([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(t5`/vector_stores/${e}/search`,tD,{body:t,method:"post",...s,headers:sy([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}nn.Files=ns,nn.FileBatches=nt;class nr extends t3{constructor(){super(...arguments),ev.add(this)}async unwrap(e,t,s=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,s,n),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,n=300){if("undefined"==typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");eN(this,ev,"m",ex).call(this,s);let r=sy([t]).values,i=eN(this,ev,"m",eS).call(this,r,"webhook-signature"),a=eN(this,ev,"m",eS).call(this,r,"webhook-timestamp"),o=eN(this,ev,"m",eS).call(this,r,"webhook-id"),l=parseInt(a,10);if(isNaN(l))throw new eZ("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-l>n)throw new eZ("Webhook timestamp is too old");if(l>c+n)throw new eZ("Webhook timestamp is too new");let h=i.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),u=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),d=o?`${o}.${a}.${e}`:`${a}.${e}`,f=await crypto.subtle.importKey("raw",u,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of h)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",f,t,new TextEncoder().encode(d)))return}catch{continue}throw new eZ("The given webhook signature does not match the expected signature")}}ev=new WeakSet,ex=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},eS=function(e,t){if(!e)throw Error("Headers are required");let s=e.get(t);if(null==s)throw Error(`Missing required header: ${t}`);return s};class ni{constructor({baseURL:e=sE("OPENAI_BASE_URL"),apiKey:t=sE("OPENAI_API_KEY"),organization:s=sE("OPENAI_ORG_ID")??null,project:n=sE("OPENAI_PROJECT_ID")??null,webhookSecret:r=sE("OPENAI_WEBHOOK_SECRET")??null,...i}={}){if(eA.add(this),ek.set(this,void 0),this.completions=new sM(this),this.chat=new sm(this),this.embeddings=new sD(this),this.files=new sF(this),this.images=new s0(this),this.audio=new sv(this),this.moderations=new s2(this),this.models=new s1(this),this.fineTuning=new sG(this),this.graders=new sZ(this),this.vectorStores=new nn(this),this.webhooks=new nr(this),this.beta=new sN(this),this.batches=new sx(this),this.uploads=new s7(this),this.responses=new s6(this),this.evals=new sq(this),this.containers=new sW(this),void 0===t)throw new eW("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let a={apiKey:t,organization:s,project:n,webhookSecret:r,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&e7())throw new eW("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");this.baseURL=a.baseURL,this.timeout=a.timeout??e$.DEFAULT_TIMEOUT,this.logger=a.logger??console;let o="warn";this.logLevel=o,this.logLevel=tI(a.logLevel,"ClientOptions.logLevel",this)??tI(sE("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=a.fetchOptions,this.maxRetries=a.maxRetries??2,this.fetch=a.fetch??function(){if("undefined"!=typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),eC(this,ek,tl,"f"),this._options=a,this.apiKey=t,this.organization=s,this.project=n,this.webhookSecret=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}authHeaders(e){return sy([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,n,r=e,i=function(e=ty){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||ty.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=tc;if(void 0!==e.format){if(!td(tu,e.format))throw TypeError("Unknown format option provided.");n=e.format}let r=tu[n],i=ty.filter;if(("function"==typeof e.filter||e2(e.filter))&&(i=e.filter),t=e.arrayFormat&&e.arrayFormat in tm?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":ty.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let a=void 0===e.allowDots?!0==!!e.encodeDotInKeys||ty.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:ty.addQueryPrefix,allowDots:a,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:ty.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:ty.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?ty.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:ty.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:ty.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:ty.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:ty.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:ty.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:ty.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:ty.strictNullHandling}}(t);"function"==typeof i.filter?r=(0,i.filter)("",r):e2(i.filter)&&(s=i.filter);let a=[];if("object"!=typeof r||null===r)return"";let o=tm[i.arrayFormat],l="comma"===o&&i.commaRoundTrip;s||(s=Object.keys(r)),i.sort&&s.sort(i.sort);let c=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];i.skipNulls&&null===r[t]||tg(a,function e(t,s,n,r,i,a,o,l,c,h,u,d,f,p,m,g,y,w){var _,b;let v,x=t,S=w,A=0,$=!1;for(;void 0!==(S=S.get(tw))&&!$;){let e=S.get(t);if(A+=1,void 0!==e)if(e===A)throw RangeError("Cyclic object value");else $=!0;void 0===S.get(tw)&&(A=0)}if("function"==typeof h?x=h(s,x):x instanceof Date?x=f?.(x):"comma"===n&&e2(x)&&(x=tp(x,function(e){return e instanceof Date?f?.(e):e})),null===x){if(a)return c&&!g?c(s,ty.encoder,y,"key",p):s;x=""}if("string"==typeof(_=x)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(b=x)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(c){let e=g?s:c(s,ty.encoder,y,"key",p);return[m?.(e)+"="+m?.(c(x,ty.encoder,y,"value",p))]}return[m?.(s)+"="+m?.(String(x))]}let k=[];if(void 0===x)return k;if("comma"===n&&e2(x))g&&c&&(x=tp(x,c)),v=[{value:x.length>0?x.join(",")||null:void 0}];else if(e2(h))v=h;else{let e=Object.keys(x);v=u?e.sort(u):e}let I=l?String(s).replace(/\./g,"%2E"):String(s),O=r&&e2(x)&&1===x.length?I+"[]":I;if(i&&e2(x)&&0===x.length)return O+"[]";for(let s=0;s<v.length;++s){let _=v[s],b="object"==typeof _&&void 0!==_.value?_.value:x[_];if(o&&null===b)continue;let S=d&&l?_.replace(/\./g,"%2E"):_,$=e2(x)?"function"==typeof n?n(O,S):O:O+(d?"."+S:"["+S+"]");w.set(t,A);let I=new WeakMap;I.set(tw,w),tg(k,e(b,$,n,r,i,a,o,l,"comma"===n&&g&&e2(x)?null:c,h,u,d,f,p,m,g,y,I))}return k}(r[t],t,o,l,i.allowEmptyArrays,i.strictNullHandling,i.skipNulls,i.encodeDotInKeys,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,c))}let h=a.join(i.delimiter),u=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),h.length>0?u+h:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${e9}`}defaultIdempotencyKey(){return`stainless-node-retry-${eM()}`}makeStatusError(e,t,s,n){return eD.generate(e,t,s,n)}buildURL(e,t,s){let n=!eN(this,eA,"m",eI).call(this)&&s||this.baseURL,r=new URL(e1(e)?e:n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),i=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(i)&&(t={...i,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new tj(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);let{req:i,url:a,timeout:o}=this.buildRequest(n,{retryCount:r-t});await this.prepareRequest(i,{url:a,options:n});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,h=Date.now();if(tP(this).debug(`[${l}] sending request`,tC({retryOfRequestLogID:s,method:n.method,url:a,options:n,headers:i.headers})),n.signal?.aborted)throw new eB;let u=new AbortController,d=await this.fetchWithTimeout(a,i,o,u).catch(eL),f=Date.now();if(d instanceof Error){let e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new eB;let r=ej(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return tP(this).info(`[${l}] connection ${r?"timed out":"failed"} - ${e}`),tP(this).debug(`[${l}] connection ${r?"timed out":"failed"} (${e})`,tC({retryOfRequestLogID:s,url:a,durationMs:f-h,message:d.message})),this.retryRequest(n,t,s??l);if(tP(this).info(`[${l}] connection ${r?"timed out":"failed"} - error; no more retries left`),tP(this).debug(`[${l}] connection ${r?"timed out":"failed"} (error; no more retries left)`,tC({retryOfRequestLogID:s,url:a,durationMs:f-h,message:d.message})),r)throw new eq;throw new eU({cause:d})}let p=[...d.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${p}] ${i.method} ${a} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${f-h}ms`;if(!d.ok){let e=this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await to(d.body),tP(this).info(`${m} - ${e}`),tP(this).debug(`[${l}] response error (${e})`,tC({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:f-h})),this.retryRequest(n,t,s??l,d.headers)}let r=e?"error; no more retries left":"error; not retryable";tP(this).info(`${m} - ${r}`);let i=await d.text().catch(e=>eL(e).message),a=e8(i),o=a?void 0:i;throw tP(this).debug(`[${l}] response error (${r})`,tC({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-h})),this.makeStatusError(d.status,a,o,d.headers)}return tP(this).info(m),tP(this).debug(`[${l}] response start`,tC({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:f-h})),{response:d,options:n,controller:u,requestLogID:l,retryOfRequestLogID:s,startTime:h}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){return new tW(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,n){let{signal:r,method:i,...a}=t||{};r&&r.addEventListener("abort",()=>n.abort());let o=setTimeout(()=>n.abort(),s),l=globalThis.ReadableStream&&a.body instanceof globalThis.ReadableStream||"object"==typeof a.body&&null!==a.body&&Symbol.asyncIterator in a.body,c={signal:n.signal,...l?{duplex:"half"}:{},method:"GET",...a};i&&(c.method=i.toUpperCase());try{return await this.fetch.call(void 0,e,c)}finally{clearTimeout(o)}}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s,n){let r,i=n?.get("retry-after-ms");if(i){let e=parseFloat(i);Number.isNaN(e)||(r=e)}let a=n?.get("retry-after");if(a&&!r){let e=parseFloat(a);r=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){let s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}return await e6(r),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:n,path:r,query:i,defaultBaseURL:a}=s,o=this.buildURL(r,i,a);"timeout"in s&&e5("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),h=this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:h,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let i=sy([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...tn(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(i),i.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=sy([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||e instanceof Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:ti(e)}:eN(this,ek,"f").call(this,{body:e,headers:s})}}e$=ni,ek=new WeakMap,eA=new WeakSet,eI=function(){return"https://api.openai.com/v1"!==this.baseURL},ni.OpenAI=e$,ni.DEFAULT_TIMEOUT=6e5,ni.OpenAIError=eW,ni.APIError=eD,ni.APIConnectionError=eU,ni.APIConnectionTimeoutError=eq,ni.APIUserAbortError=eB,ni.NotFoundError=eJ,ni.ConflictError=eK,ni.RateLimitError=ez,ni.BadRequestError=eF,ni.AuthenticationError=eX,ni.InternalServerError=eY,ni.PermissionDeniedError=eH,ni.UnprocessableEntityError=eV,ni.InvalidWebhookSignatureError=eZ,ni.toFile=t1,ni.Completions=sM,ni.Chat=sm,ni.Embeddings=sD,ni.Files=sF,ni.Images=s0,ni.Audio=sv,ni.Moderations=s2,ni.Models=s1,ni.FineTuning=sG,ni.Graders=sZ,ni.VectorStores=nn,ni.Webhooks=nr,ni.Beta=sN,ni.Batches=sx,ni.Uploads=s7,ni.Responses=s6,ni.Evals=sq,ni.Containers=sW;let na=new ni({apiKey:process.env.OPENAI_API_KEY}),no=`You are Chorbit, an AI assistant helping families understand behavioral patterns and emotional intelligence. 

When analyzing behavioral data, focus on:
- Finding positive patterns to reinforce
- Identifying triggers compassionately 
- Suggesting constructive solutions
- Encouraging growth mindset
- Respecting family dynamics

Always frame insights as opportunities for growth, not judgments. Help parents approach conversations with curiosity rather than criticism.`;class nl{async generateDailyReflectionPrompts(e,t){return t<=2?["It sounds like today was tough. What happened?","What's one small thing that could help tomorrow feel better?","Who could you talk to about how you're feeling?","What usually helps when you feel this way?"]:t>=4?["You seem really happy! What made today so great?","What did you do differently that worked well?","How could you help others feel this good too?","What would you want to remember about today?"]:["What made you smile today?","What felt challenging today?","How did you handle tough moments?","What are you proud of from today?","What would make tomorrow even better?"]}async analyzeWeeklyPatterns(e){if(0===e.length)throw Error("No check-ins to analyze");let t=e[0].userId,s=new Date(Math.min(...e.map(e=>e.date.getTime()))),n=new Date(Math.max(...e.map(e=>e.date.getTime()))),r=e.reduce((e,t)=>e+t.overallMood,0)/e.length,i=e.map(e=>e.respectfulCommunication?5:1),a=e.map(e=>e.selfMotivation),o=this.calculateTrend(i),l=this.calculateTrend(a),c=await this.findBehaviorPatterns(e),h=await this.generateAIInsights(e,c);return{userId:t,weekStart:s,weekEnd:n,averageMood:r,respectTrend:o,selfMotivationTrend:l,patterns:c,triggers:this.identifyTriggers(e),...h}}calculateTrend(e){if(e.length<3)return"stable";let t=e.slice(0,Math.floor(e.length/2)),s=e.slice(Math.floor(e.length/2)),n=t.reduce((e,t)=>e+t,0)/t.length,r=s.reduce((e,t)=>e+t,0)/s.length-n;return r>.5?"improving":r<-.5?"declining":"stable"}async findBehaviorPatterns(e){let t=[],s=e.filter(e=>"friends"===e.socialTime).map(t=>{let s=e.find(e=>e.date.getTime()===t.date.getTime()+864e5);return s?.overallMood||null}).filter(e=>null!==e);if(s.length>2){let n=s.reduce((e,t)=>e+t,0)/s.length,r=e.reduce((e,t)=>e+t.overallMood,0)/e.length;Math.abs(n-r)>.8&&t.push({pattern:n>r?"Friend time consistently improves next-day mood":"Challenging behavior often follows friend time",confidence:Math.min(95,20*s.length),correlation:{trigger:"friend_time",behavior:"next_day_mood",strength:(n-r)/2},recommendations:n>r?["Continue encouraging healthy friendships","Consider regular friend time as mood booster"]:["Explore post-friend-time routines","Check if friend activities affect sleep/routine"],dataPoints:s.length})}let n=e.filter(e=>{let t=parseInt(e.bedtimeLastNight.split(":")[0]);return t>=22||t<=6});if(n.length>1){let s=n.reduce((e,t)=>e+t.overallMood,0)/n.length,r=e.reduce((e,t)=>e+t.overallMood,0)/e.length;s<r-.5&&t.push({pattern:"Late bedtimes correlate with difficult next days",confidence:Math.min(90,25*n.length),correlation:{trigger:"late_bedtime",behavior:"next_day_mood",strength:(s-r)/2},recommendations:["Consider earlier bedtime routine","Track what causes late nights","Plan easier days after late nights"],dataPoints:n.length})}return t}identifyTriggers(e){let t=[],s=[],n=e.filter(e=>e.overallMood>=4&&e.respectfulCommunication),r=e.filter(e=>e.overallMood<=2||!e.respectfulCommunication);return Object.entries(n.flatMap(e=>e.physicalActivity).reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{})).forEach(([e,s])=>{s>=.6*n.length&&t.push(`physical_activity_${e}`)}),Object.entries(r.flatMap(e=>e.stressors).reduce((e,t)=>(e[t]=(e[t]||0)+1,e),{})).forEach(([e,t])=>{t>=.5*r.length&&s.push(e)}),{positive:t,negative:s}}async generateAIInsights(e,t){let s=`Analyze this week's behavior data for a child:

Average mood: ${e.reduce((e,t)=>e+t.overallMood,0)/e.length}/5
Respectful communication: ${e.filter(e=>e.respectfulCommunication).length}/${e.length} days
Physical activity days: ${e.filter(e=>e.physicalActivity.length>0).length}/${e.length}

Identified patterns:
${t.map(e=>`- ${e.pattern} (${e.confidence}% confidence)`).join("\n")}

Parent notes this week:
${e.map(e=>e.parentNotes).filter(e=>e).join("\n")}

Please provide:
1. A compassionate summary for parents
2. 3 conversation starters for parent-child discussions
3. 2 encouraging messages for the child
4. 2 family routine recommendations
5. 1 schedule adjustment suggestion`;try{let e=await na.chat.completions.create({model:process.env.OPENAI_MODEL||"gpt-4",messages:[{role:"system",content:no},{role:"user",content:s}],max_tokens:500,temperature:.7});return{aiSummary:e.choices[0]?.message?.content||"",parentConversationStarters:["I noticed you've been doing great with morning routines - what's helping you with that?","The data shows you're happiest when you're active - should we plan more of that?","You seem to handle stress better this week - what changed?"],childEncouragement:["You're really growing in how you handle tough situations! \uD83C\uDF1F","I can see you putting effort into being respectful - that takes real maturity!"],familyRecommendations:["Consider a consistent bedtime routine to support mood stability","Physical activity seems to be a powerful mood booster for your family"],scheduleAdjustments:["Try moving challenging activities to times when energy is naturally higher"]}}catch(e){return console.error("AI insight generation error:",e),{aiSummary:"This week showed some interesting patterns worth exploring together as a family.",parentConversationStarters:["How did this week feel for you overall?","What helped you have good days this week?","What made some days more challenging?"],childEncouragement:["Every day is a chance to grow and learn!","You're building great habits and skills!"],familyRecommendations:["Keep tracking patterns to understand what works best","Celebrate the positive trends you're seeing"],scheduleAdjustments:["Consider timing and energy levels when planning activities"]}}}}async function nc(e){try{let t=`
    Analyze this child's daily check-in data and provide insights:
    
    Check-in Data:
    - Morning Energy: ${e.morningEnergy}/4
    - Overall Mood: ${e.overallMood}/5
    - Activities: ${e.physicalActivity?.join(", ")||"None listed"}
    - Social Time: ${e.socialTime||"Not specified"}
    - Screen Time: ${e.screenTime||"Not specified"} minutes
    - Bedtime Last Night: ${e.bedtimeLastNight||"Not specified"}
    - Stressors: ${e.stressors?.join(", ")||"None"}
    - Special Events/Todos: ${e.specialEvents?.join(", ")||"None"}
    
    Please provide:
    1. Brief insights about patterns (max 50 words each)
    2. Recommendations for improvement (max 50 words each)
    3. Positive reinforcements (max 30 words each)
    
    Keep responses kid-friendly and encouraging!
    `,s=await fetch("/api/chorbit/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:t,userId:e.userId,context:{type:"check_in_analysis",data:e}})});if(s.ok)return await s.json(),{patterns:["Energy levels seem to correlate with physical activity! \uD83C\uDFC3‍♂️","Your mood is higher when you spend time with friends \uD83D\uDC6B","Consistent bedtime helps with morning energy \uD83D\uDE34"],recommendations:["Try to include some physical activity every day","Balance screen time with other activities","Keep up the great work on homework completion!"],positiveReinforcements:["Great job being active today! \uD83D\uDCAA","Love seeing you prioritize friend time \uD83D\uDC6B","You're developing awesome self-awareness! \uD83E\uDDE0"],concernAreas:e.stressors||[],correlations:{energyBoostActivities:e.physicalActivity?.filter(e=>["sports","bike","run","gym","soccer"].some(t=>e.includes(t)))||[],moodBoosters:e.socialTime?["social_interaction"]:[],sleepImpact:e.bedtimeLastNight&&e.morningEnergy?"Good bedtime routine supports morning energy":void 0}};return{patterns:["Thanks for sharing about your day! \uD83D\uDE0A"],recommendations:["Keep being awesome! \uD83C\uDF1F"],positiveReinforcements:["You're doing great! \uD83D\uDCAB"],concernAreas:[],correlations:{}}}catch(e){return console.error("AI analysis failed:",e),{patterns:["Thanks for completing your check-in! \uD83D\uDCDD"],recommendations:["Keep reflecting on your day - it helps you grow! \uD83C\uDF31"],positiveReinforcements:["Your self-awareness is amazing! \uD83E\uDDE0"],concernAreas:[],correlations:{}}}}async function nh(e){try{let t=await e.json();if(!t.userId||!t.date)return eP.NextResponse.json({error:"Missing required fields: userId and date"},{status:400});let s=await nc(t),n={id:`checkin-${Date.now()}`,...t,insights:s,timestamp:new Date().toISOString(),success:!0};return eP.NextResponse.json(n)}catch(e){return console.error("Check-in submission error:",e),eP.NextResponse.json({error:"Failed to process check-in"},{status:500})}}async function nu(e){try{let{searchParams:t}=new URL(e.url),s=t.get("userId");if(t.get("date"),!s)return eP.NextResponse.json({error:"Missing userId parameter"},{status:400});let n=[{id:"checkin-1",userId:s,date:new Date().toISOString(),morningEnergy:3,overallMood:4,physicalActivity:["homework","soccer","gaming"],socialTime:"friends",screenTime:120,bedtimeLastNight:"21:30",stressors:["homework_pressure"],specialEvents:["finish_homework","soccer_practice"]}];return eP.NextResponse.json(n)}catch(e){return console.error("Check-in fetch error:",e),eP.NextResponse.json({error:"Failed to fetch check-ins"},{status:500})}}new nl;let nd=new eR.AppRouteRouteModule({definition:{kind:eE.RouteKind.APP_ROUTE,page:"/api/check-in/route",pathname:"/api/check-in",filename:"route",bundlePath:"app/api/check-in/route"},resolvedPagePath:"/codebuild/output/src3049652603/src/ChoreChart/web/src/app/api/check-in/route.ts",nextConfigOutput:"",userland:eO}),{workAsyncStorage:nf,workUnitAsyncStorage:np,serverHooks:nm}=nd;function ng(){return(0,eT.patchFetch)({workAsyncStorage:nf,workUnitAsyncStorage:np})}},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},78335:()=>{},96487:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),n=t.X(0,[243,580],()=>s(30493));module.exports=n})();